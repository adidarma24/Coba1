@using MudBlazor

<div class="mud-dialog-content">
  <MudStack Spacing="2">
    @foreach (var method in PaymentMethods)
    {
      <MudItem>
        <div class="payment-option @(SelectedMethod == method.Name ? "selected-method" : "")"
          @onclick="@(() => SetSelectedMethod(method.Name))">
          <div class="icon-circle">
            <img src="@method.Icon" class="payment-icon" />
          </div>
          <MudText Class="payment-name">@method.Name</MudText>
        </div>
      </MudItem>
    }
  </MudStack>
</div>

<div class="mud-dialog-actions d-flex justify-center mud-dialog-actions">
  <MudButton Variant="Variant.Outlined" Color="Color.Default" OnClick="Cancel" Class="action-btn cancel-btn">
    Cancel
  </MudButton>
  <MudButton Variant="Variant.Filled" Color="Color.Warning" OnClick="ConfirmPayNow"
    Disabled="@(string.IsNullOrEmpty(SelectedMethod))" Class="action-btn pay-btn ml-3" Style="color:black;">
    Pay Now
  </MudButton>
</div>

@code {
  // [PERUBAHAN] Menggunakan MudDialogInstance untuk interaksi dialog yang lebih aman dan bersih.
  [CascadingParameter]
  public dynamic? MudDialog { get; set; }

  [Parameter] public decimal TotalPrice { get; set; }

  private string? SelectedMethod { get; set; }

  // Daftar metode pembayaran tidak berubah
  private List<(string Name, string Icon)> PaymentMethods = new()
{
("Gopay", "images/payment/gopay.svg"),
("OVO", "images/payment/ovo.svg"),
("DANA", "images/payment/dana.svg"),
("Mandiri", "images/payment/mandiri.svg"),
("BCA", "images/payment/bca.svg"),
("BNI", "images/payment/bni.svg"),
};

  private void SetSelectedMethod(string method)
  {
    SelectedMethod = method;
  }
 
  // [PERUBAHAN] Fungsi Cancel menjadi lebih sederhana.
  private void Cancel()
  {
    // Cukup panggil MudDialog.Cancel() untuk menutup dialog sebagai "dibatalkan".
    MudDialog?.Cancel();
  }

  // [PERUBAHAN] Fungsi ConfirmPayNow juga menjadi lebih sederhana.
  private void ConfirmPayNow()
  {
    if (!string.IsNullOrEmpty(SelectedMethod))
    {
      // Gunakan MudDialog.Close() untuk menutup dialog dan mengembalikan data.
      MudDialog?.Close(global::MudBlazor.DialogResult.Ok(SelectedMethod));
    }
  }
}

<style>
  /* Semua style Anda tetap sama karena sudah sesuai dengan tampilan yang diinginkan */
  .payment-option {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 10px 8px;
    border-radius: 8px;
    transition: background-color 0.12s ease;
  }

  .payment-option:hover {
    background-color: #f5f5f5;
  }

  .payment-option.selected-method {
    background-color: #fff6df;
    border: 1px solid #f2b705;
  }

  .icon-circle {
    width: 44px;
    height: 44px;
    min-width: 44px;
    border-radius: 50%;
    background: #f6f9fa;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    box-shadow: 0 1px 2px rgba(16, 24, 40, 0.04);
  }

  .payment-icon {
    width: 20px;
    height: 20px;
    display: block;
    margin: 0 auto;
    max-height: 20px;
  }

  .payment-name {
    font-size: 16px;
    color: rgba(0, 0, 0, 0.85);
  }

  .action-btn {
    min-width: 100px;
    border-radius: 8px;
    font-weight: 500;
  }

  .cancel-btn {
    border: 1px solid #4b2e2e;
    color: #4b2e2e;
    background: #fff;
  }

  .pay-btn {
    background-color: #f2b705;
    color: #000;
    font-weight: 600;
  }

  .mud-dialog-actions {
    justify-content: center !important;
    margin-top: 16px;
    margin-bottom: 16px;
    gap: 12px;
  }

  .mud-dialog-title {
    text-align: center;
    width: 100%;
    font-weight: 600;
  }

  .mud-dialog {
    max-width: 400px !important;
    width: 90% !important;
  }
</style>